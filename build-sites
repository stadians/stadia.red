#!/usr/bin/env bash
set -euo pipefail
shopt -s inherit_errexit nullglob compat"${BASH_COMPAT=42}"
cd "$(dirname "${BASH_SOURCE}")"

declare source="$PWD/stadia.run/index.html"
declare target="$PWD/stadia.run/-/index.html"

rm -f "$target/"*.mjs

declare -a names=(main.mjs)

for name in "${names[@]}"; do
  declare path="$target/$name"
  echo "// @generated from index.html, do not edit directly." > "$path"
  echo -n "// " >> "$path"
  sed -n -e '/<script type="module" id="main.mjs">/,/<\/script>/ p' "$source" | sed -e '$d' >> "$path"
done
